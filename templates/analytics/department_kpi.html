{% extends "base/base_dashboard.html" %}

{% block title %}Department KPI{% endblock %}

{% block dashboard_content %}
<div class="content-header">
    <h1>Department KPI Analysis</h1>
</div>

<!-- Year Filter -->
<div class="filter-panel mb-4">
    <form method="get" class="d-flex align-items-center gap-2">
        <label for="year" class="mb-0">Year:</label>
        <input type="number" name="year" value="{{ selected_year }}" class="form-control" style="max-width: 150px;" />
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>
</div>

<div class="charts-container">
    <!-- KPI Trend Chart -->
    <div class="chart-wrapper">
        <canvas id="kpiTrendChart"></canvas>
    </div>

    <!-- Department Comparison Chart -->
    <div class="chart-wrapper">
        <canvas id="deptComparisonChart"></canvas>
    </div>
</div>

<script>
const kpiTrendData = {{ kpi_trend_data|safe }};
const deptComparisonData = {{ department_comparison_data|safe }};

// KPI Trend Chart (Line Chart)
if (kpiTrendData && document.getElementById('kpiTrendChart')) {
    new Chart(document.getElementById('kpiTrendChart'), {
        type: 'line',
        data: kpiTrendData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'KPI Trends Over Time'
                },
                legend: {
                    display: true,
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
}

// Department Comparison Chart (Bar Chart)
if (deptComparisonData && document.getElementById('deptComparisonChart')) {
    new Chart(document.getElementById('deptComparisonChart'), {
        type: 'bar',
        data: deptComparisonData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Employment Rate by Department'
                },
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return 'Employment Rate: ' + context.parsed.y.toFixed(2) + '%';
                        }
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        autoSkip: false,
                        maxRotation: 45,
                        minRotation: 45
                    }
                },
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
}
</script>
{% endblock %}
