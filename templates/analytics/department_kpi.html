{% extends "base/base_dashboard.html" %}

{% block title %}Department KPI{% endblock %}

{% block dashboard_content %}
<div class="kpi-container">
    <h1>Department KPI Analysis</h1>

    <!-- Year Filter -->
    <div class="filter-panel">
        <form method="get">
            <label for="year">Year:</label>
            <input type="number" name="year" value="{{ selected_year }}" />
            <button type="submit">Filter</button>
        </form>
    </div>

    <!-- KPI Trend Chart -->
    <div class="chart-wrapper">
        <canvas id="kpiTrendChart"></canvas>
    </div>

    <!-- Department Comparison Chart -->
    <div class="chart-wrapper">
        <canvas id="deptComparisonChart"></canvas>
    </div>
</div>

<script>
const kpiTrendData = {{ kpi_trend_data|safe }};
const deptComparisonData = {{ department_comparison_data|safe }};

// KPI Trend Chart (Line Chart)
if (kpiTrendData && document.getElementById('kpiTrendChart')) {
    new Chart(document.getElementById('kpiTrendChart'), {
        type: 'line',
        data: kpiTrendData,
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                title: {
                    display: true,
                    text: 'KPI Trends Over Time'
                },
                legend: {
                    display: true,
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
}

// Department Comparison Chart (Bar Chart)
if (deptComparisonData && document.getElementById('deptComparisonChart')) {
    new Chart(document.getElementById('deptComparisonChart'), {
        type: 'bar',
        data: deptComparisonData,
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Employment Rate by Department'
                },
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
}
</script>
{% endblock %}
