{% extends "base/base_dashboard.html" %}

{% block title %}내 정보 - VMC6{% endblock %}

{% block dashboard_content %}
<div class="content-header">
    <h1>내 정보</h1>
    <p class="text-muted">계정 정보 관리</p>
</div>

<div class="row">
    <div class="col-lg-8">
        <!-- Profile Information Card -->
        <div class="card shadow mb-4">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">기본 정보</h6>
            </div>
            <div class="card-body">
                <form method="post" id="profileForm">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label">이메일</label>
                        <input type="email" class="form-control" value="{{ user.email }}" readonly disabled>
                        <small class="text-muted">이메일은 변경할 수 없습니다.</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">사용자명</label>
                        <input type="text" class="form-control" name="username" value="{{ user.username }}" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">부서</label>
                        <input type="text" class="form-control" name="department" value="{{ user.department|default:'' }}" placeholder="소속 학과">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">역할</label>
                        <input type="text" class="form-control" value="{{ user.get_role_display }}" readonly disabled>
                        <small class="text-muted">역할은 관리자만 변경할 수 있습니다.</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">계정 상태</label>
                        <input type="text" class="form-control" value="{{ user.get_is_active_display }}" readonly disabled>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">가입일</label>
                        <input type="text" class="form-control" value="{{ user.created_at|date:'Y년 m월 d일 H:i' }}" readonly disabled>
                    </div>

                    <button type="submit" class="btn btn-primary">정보 수정</button>
                </form>
            </div>
        </div>

        <!-- Change Password Card -->
        <div class="card shadow">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">비밀번호 변경</h6>
            </div>
            <div class="card-body">
                <form method="post" id="passwordForm">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label">현재 비밀번호</label>
                        <input type="password" class="form-control" name="current_password" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">새 비밀번호</label>
                        <input type="password" class="form-control" name="new_password1" required>
                        <small class="text-muted">최소 8자 이상, 영문과 숫자를 포함해야 합니다.</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">새 비밀번호 확인</label>
                        <input type="password" class="form-control" name="new_password2" required>
                    </div>

                    <button type="submit" class="btn btn-warning">비밀번호 변경</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Quick Stats Card -->
        <div class="card shadow">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">계정 요약</h6>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <i class="bi bi-person-circle" style="font-size: 4rem; color: #6c757d;"></i>
                </div>
                <hr>
                <p><strong>이메일:</strong><br>{{ user.email }}</p>
                <p><strong>사용자명:</strong><br>{{ user.username }}</p>
                <p><strong>역할:</strong><br>
                    <span class="badge bg-{% if user.role == 'admin' %}danger{% elif user.role == 'manager' %}warning{% else %}info{% endif %}">
                        {{ user.get_role_display }}
                    </span>
                </p>
                <p><strong>상태:</strong><br>
                    <span class="badge bg-{% if user.is_active == 'active' %}success{% elif user.is_active == 'pending' %}warning{% else %}danger{% endif %}">
                        {{ user.get_is_active_display }}
                    </span>
                </p>
                {% if user.department %}
                <p><strong>부서:</strong><br>{{ user.department }}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Profile form submission
    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('프로필 업데이트 기능은 아직 구현되지 않았습니다.');
    });

    // Password form submission
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('비밀번호 변경 기능은 아직 구현되지 않았습니다.');
    });
</script>
{% endblock %}